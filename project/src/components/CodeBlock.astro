---
interface Props {
  language?: string;
  title?: string;
}

const { language = 'js', title } = Astro.props;
---

<div class="code-block">
  {title && (
    <div class="code-block-title">
      {title}
    </div>
  )}
  <pre class={`language-${language}`}>
    <code class={`language-${language}`}>
      <slot />
    </code>
  </pre>
  <button class="copy-button" aria-label="Copy code to clipboard">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
    </svg>
  </button>
</div>

<style>
  .code-block {
    @apply relative rounded-lg overflow-hidden my-6;
  }
  
  .code-block-title {
    @apply px-4 py-2 text-xs font-medium bg-neutral-800 text-neutral-200 border-b border-neutral-700;
  }
  
  .code-block pre {
    @apply my-0 max-h-[400px] overflow-y-auto;
  }
  
  .copy-button {
    @apply absolute top-2 right-2 p-1.5 rounded-md text-neutral-400 hover:text-neutral-100 
    hover:bg-neutral-700 transition-colors duration-200 opacity-0 group-hover:opacity-100;
  }
  
  .code-block:hover .copy-button {
    @apply opacity-100;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const copyButtons = document.querySelectorAll('.copy-button');
    
    copyButtons.forEach(button => {
      button.addEventListener('click', () => {
        const codeBlock = button.closest('.code-block');
        if (!codeBlock) return;
        
        const code = codeBlock.querySelector('code');
        if (!code) return;
        
        navigator.clipboard.writeText(code.textContent || '')
          .then(() => {
            const original = button.innerHTML;
            button.innerHTML = `
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
            `;
            
            setTimeout(() => {
              button.innerHTML = original;
            }, 2000);
          })
          .catch(err => {
            console.error('Failed to copy: ', err);
          });
      });
    });
  });
</script>